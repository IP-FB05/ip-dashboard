<form role="form" name="form">

	<p id="allNote"> </p>

	<script cam-script type="text/form-script">

		var variableManager = camForm.variableManager;
		var modulID;
		var studentsList; // json / array
		var students ; //unused?

		camForm.on('form-loaded', 
			function() {
				variableManager.fetchVariable('modul');
				variableManager.fetchVariable('Students');
			}
		);

		camForm.on('variables-fetched', 
			function() {
				modulID = variableManager.variableValue('modul');
				studentsList = variableManager.variableValue('Students');

				studentsList = JSON.parse(studentsList); //

				populateForm(studentsList);
			}
		);
		
		function populateForm(dataJSON) {
		
			var outString = "";
			for (var i = 0; i < Object.keys(studentsList).length; i++){
				var id = Object.keys(studentsList)[i];
				var note = studentsList[Object.keys(studentsList)[i]]
				outString = outString + "<div> " + id + " Note: <input type=\"text\" value=\"" + note + "\" name=\"" + id + "\" id=\"" + id + "\"> <br> </div>";
			}
			console.log(outString)
			document.getElementById("allNote").innerHTML = outString;
		}
		
		

		camForm.on('submit',
			function(evt) {
				for (let i = 0; i <  Object.keys(studentsList).length; i++) {
					studentsList[Object.keys(studentsList)[i]] = document.getElementById(i).value; ; //
				}
				
				variableManager.destroyVariable('Students');
				camForm.variableManager.createVariable({
					name: 'Students',
					type: 'json',
					value: JSON.stringify(studentsList)
				});
			}
		);
		
	</script>

</form>