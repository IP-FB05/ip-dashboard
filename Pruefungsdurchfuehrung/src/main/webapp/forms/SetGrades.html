<form ng-submit="submit()" role="form" name="form">


	<div ng-repeat="x in students">
	{{x.ID}}
	Note: <input type="text" value={{x.note}} name={{x.ID}} id={{x.ID}}><br>
	</div>
	
	<input type="text" name="gadget_url" id="gadget_url">
	
	<script cam-script type="text/form-script">


		var variableManager = camForm.variableManager;
		var modulID;
		var final;
		var studentsList;
		var students = $scope.students = [];

    	camForm.on('form-loaded', function() {

      		variableManager.fetchVariable('modul');
			variableManager.fetchVariable('final');
			variableManager.fetchVariable('Students');

		});

		camForm.on('variables-fetched', function() {
      		modulID = variableManager.variableValue('modul');
			final = variableManager.variableValue('final');
			studentsList = variableManager.variableValue('Students');


			//document.getElementById('gadget_url').value = studentsList;
			studentsList = JSON.parse(studentsList);

			
			for (let i = 0; i <  Object.keys(studentsList).length; i++) {
				
				$scope.students.push({ID:Object.keys(studentsList)[i],note:studentsList[Object.keys(studentsList)[i]]});
				//document.getElementById('gadget_url').value = Object.keys(studentsList)[i];
				//document.getElementById('gadget_url').value = studentsList[Object.keys(studentsList)[i]];

			}
  	
		});


		camForm.on('submit', function(evt) {

			for (let i = 0; i <  Object.keys(studentsList).length; i++) {
				studentsList[Object.keys(studentsList)[i]] = angular.element(document.getElementById($scope.students[i].ID)).val();
			}

    		//variableManager.createVariable({name: 'Students',type: 'json', value:JSON.stringify(studentsList) });
			//variableManager.variableValue('Students',JSON.stringify(studentsList));

			variableManager.destroyVariable('Students');

			camForm.variableManager.createVariable({
			  name: 'Students', //_List',
			  type: 'json',//'String',
			  value: JSON.stringify(studentsList)
			});



		});



	</script>

</form>

